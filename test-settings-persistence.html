<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Settings Persistence Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            border: 2px solid #ccc;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .success { border-color: #10b981; background: #f0fdf4; }
        .error { border-color: #ef4444; background: #fef2f2; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background: #3498db;
            color: white;
            font-size: 14px;
        }
        button:hover { background: #2980b9; }
        .log {
            background: #1e1e1e;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ Brand Settings Persistence Test</h1>
    
    <div class="test-section">
        <h3>1Ô∏è‚É£ Test Direct URL</h3>
        <p>Open de editor met cache-busting parameter:</p>
        <a href="https://www.ai-websitestudio.nl/simple-template-editor.html?v=20251126&brand_id=0766a61a-8f37-4a83-bf28-e15084d764fb&token=YOUR_TOKEN&apikey=YOUR_KEY" target="_blank">
            <button>Open Editor (New Version)</button>
        </a>
    </div>
    
    <div class="test-section">
        <h3>2Ô∏è‚É£ Check Current Deployment</h3>
        <button onclick="checkDeployment()">Check Latest Deployment</button>
        <div id="deploymentResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3Ô∏è‚É£ Fetch Latest HTML</h3>
        <button onclick="fetchLatestHTML()">Fetch Editor HTML</button>
        <div id="htmlResult"></div>
    </div>
    
    <div class="test-section">
        <h3>4Ô∏è‚É£ Test Script Injection</h3>
        <p>Dit script inject de fix direct in je huidige editor:</p>
        <button onclick="copyFixScript()">Copy Fix Script</button>
        <textarea id="fixScript" readonly style="width: 100%; height: 150px; margin-top: 10px; font-family: monospace; font-size: 11px;">
// PASTE THIS IN CONSOLE OF YOUR EDITOR
(function() {
    if (window.editor) {
        console.log('‚úÖ Editor found! Patching...');
        
        // Patch loadPage to always apply settings
        const originalLoadPage = window.editor.loadPage.bind(window.editor);
        window.editor.loadPage = async function(page) {
            await originalLoadPage(page);
            console.log('üîß Patched loadPage - loading settings...');
            await this.loadBrandSettings();
            setTimeout(() => {
                this.applySettings();
                console.log('‚úÖ Settings applied after page load');
            }, 200);
        };
        
        console.log('‚úÖ Patch applied! Now load a page and settings should persist.');
    } else {
        console.error('‚ùå Editor not found. Make sure you\'re on the editor page.');
    }
})();
        </textarea>
    </div>
    
    <div class="log" id="log"></div>
    
    <script>
        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#0ff';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function checkDeployment() {
            log('Checking deployment status...');
            const result = document.getElementById('deploymentResult');
            
            try {
                // Check if we can reach the editor
                const response = await fetch('https://www.ai-websitestudio.nl/simple-template-editor.html?v=' + Date.now(), {
                    method: 'HEAD'
                });
                
                if (response.ok) {
                    result.innerHTML = '<p style="color: green">‚úÖ Editor is reachable. Last modified: ' + response.headers.get('last-modified') + '</p>';
                    log('‚úÖ Deployment is live', 'success');
                } else {
                    result.innerHTML = '<p style="color: red">‚ùå Error: ' + response.status + '</p>';
                    log('‚ùå Deployment check failed: ' + response.status, 'error');
                }
            } catch (error) {
                result.innerHTML = '<p style="color: red">‚ùå Error: ' + error.message + '</p>';
                log('‚ùå Error: ' + error.message, 'error');
            }
        }
        
        async function fetchLatestHTML() {
            log('Fetching latest HTML...');
            const result = document.getElementById('htmlResult');
            
            try {
                const response = await fetch('https://www.ai-websitestudio.nl/simple-template-editor.html?v=' + Date.now());
                const html = await response.text();
                
                // Check if new code exists
                const hasNewCode = html.includes('loadBrandSettings()') && html.includes('updateSettingsUI()');
                const hasDebugLogs = html.includes('üé® Updating settings UI with:');
                
                if (hasNewCode && hasDebugLogs) {
                    result.innerHTML = '<p style="color: green">‚úÖ NEW VERSION DETECTED! The fix is live.</p>';
                    log('‚úÖ Latest code includes all fixes!', 'success');
                    
                    // Show snippet
                    const snippet = html.substring(html.indexOf('async loadBrandSettings'), html.indexOf('async loadBrandSettings') + 500);
                    result.innerHTML += '<details><summary>Show code snippet</summary><pre style="font-size: 10px; max-height: 200px; overflow: auto;">' + snippet.replace(/</g, '&lt;') + '</pre></details>';
                } else {
                    result.innerHTML = '<p style="color: orange">‚ö†Ô∏è Old version still cached somewhere</p>';
                    log('‚ö†Ô∏è Old version detected in fetch', 'error');
                }
                
            } catch (error) {
                result.innerHTML = '<p style="color: red">‚ùå Error: ' + error.message + '</p>';
                log('‚ùå Error: ' + error.message, 'error');
            }
        }
        
        function copyFixScript() {
            const script = document.getElementById('fixScript');
            script.select();
            document.execCommand('copy');
            log('‚úÖ Fix script copied to clipboard!', 'success');
            alert('Fix script copied! Paste it in the console of your editor page.');
        }
        
        // Initial log
        log('Test page loaded. Click buttons above to diagnose.');
    </script>
</body>
</html>
