<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nieuws & Blog || Gotur</title>

    <!-- favicons Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png">

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Just+Another+Hand&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/vendors/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/vendors/animate/animate.min.css">
    <link rel="stylesheet" href="assets/vendors/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="assets/vendors/gotur-icons/style.css">

    <!-- template styles -->
    <link rel="stylesheet" href="assets/css/gotur.css">
    
    <style>
        .loading-state {
            text-align: center;
            padding: 60px 20px;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body class="custom-cursor">
    <div class="custom-cursor__cursor"></div>
    <div class="custom-cursor__cursor-two"></div>

    <div class="preloader">
        <div class="preloader__image" style="background-image: url(assets/images/loader.png);"></div>
    </div>

    <div class="page-wrapper">
        <!-- Page Header -->
        <section class="page-header">
            <div class="page-header__bg" style="background-image: url('assets/images/backgrounds/page-header-bg-1-1.jpg');"></div>
            <div class="container">
                <h2 class="page-header__title">Nieuws & Blog</h2>
                <ul class="gotur-breadcrumb list-unstyled">
                    <li><a href="index.html">Home</a></li>
                    <li><span>Nieuws</span></li>
                </ul>
            </div>
        </section>

        <!-- Blog Grid -->
        <section class="blog-one section-space">
            <div class="container">
                <div class="row gutter-y-30" id="blogGrid">
                    <!-- Loading state -->
                    <div class="col-12 loading-state" id="loadingState">
                        <div class="loading-spinner"></div>
                        <p>Nieuwsberichten laden...</p>
                    </div>
                    <!-- Blog posts will be loaded here -->
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script>
        // Get brand ID from URL or localStorage
        const urlParams = new URLSearchParams(window.location.search);
        const brandId = urlParams.get('brand_id') || localStorage.getItem('current_brand_id');
        
        async function loadBlogPosts() {
            try {
                const response = await fetch(`/api/content/news?brandId=${brandId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to load blog posts');
                }
                
                const posts = await response.json();
                
                // Hide loading state
                document.getElementById('loadingState').style.display = 'none';
                
                // Render blog posts
                const grid = document.getElementById('blogGrid');
                
                if (posts.length === 0) {
                    grid.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <p class="text-muted">Nog geen nieuwsberichten beschikbaar.</p>
                        </div>
                    `;
                    return;
                }
                
                posts.forEach(post => {
                    const card = createBlogCard(post);
                    grid.appendChild(card);
                });
                
            } catch (error) {
                console.error('Error loading blog posts:', error);
                document.getElementById('loadingState').innerHTML = `
                    <p class="text-danger">Fout bij laden van nieuwsberichten. Probeer het later opnieuw.</p>
                `;
            }
        }
        
        function createBlogCard(post) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';
            
            col.innerHTML = `
                <div class="blog-card">
                    <div class="blog-card__image">
                        <img src="${post.image}" alt="${post.title}">
                        <a href="blog-detail-dynamic.html?slug=${post.slug}&brand_id=${brandId}" class="blog-card__image__link">
                            <span class="sr-only">${post.title}</span>
                        </a>
                    </div>
                    <div class="blog-card__content">
                        <div class="blog-card__meta">
                            <div class="blog-card__meta__item">
                                <i class="icon-user"></i>
                                ${post.author}
                            </div>
                            <div class="blog-card__meta__item">
                                <i class="icon-calendar"></i>
                                ${post.date}
                            </div>
                        </div>
                        <h3 class="blog-card__title">
                            <a href="blog-detail-dynamic.html?slug=${post.slug}&brand_id=${brandId}">
                                ${post.title}
                            </a>
                        </h3>
                        <p class="blog-card__text">${post.excerpt}</p>
                        <a href="blog-detail-dynamic.html?slug=${post.slug}&brand_id=${brandId}" class="blog-card__link">
                            Lees meer
                            <i class="icon-right-arrow"></i>
                        </a>
                    </div>
                </div>
            `;
            
            return col;
        }
        
        // Load blog posts on page load
        document.addEventListener('DOMContentLoaded', loadBlogPosts);
    </script>

    <!-- Scripts -->
    <script src="assets/vendors/jquery/jquery-3.7.0.min.js"></script>
    <script src="assets/vendors/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendors/wow/wow.js"></script>
    <!-- template js -->
    <script src="assets/js/gotur.js"></script>
</body>
</html>
