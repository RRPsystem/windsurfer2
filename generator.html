<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Travel Video - Professionele Reisvideo's</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="/js/media.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0f172a;
      min-height: 100vh;
      color: #e2e8f0;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 280px;
      background: #1e293b;
      border-right: 1px solid #334155;
      display: flex;
      flex-direction: column;
      z-index: 100;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid #334155;
    }

    .sidebar-header h1 {
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-header h1 i {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 0;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 24px;
      color: #94a3b8;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: rgba(139, 92, 246, 0.1);
      color: #e2e8f0;
    }

    .nav-item.active {
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
      border-left-color: #8b5cf6;
    }

    .nav-item i {
      width: 20px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 16px 24px;
      border-top: 1px solid #334155;
      font-size: 12px;
      color: #64748b;
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      min-height: 100vh;
      padding: 32px;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-header h2 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-header p {
      color: #94a3b8;
      font-size: 16px;
    }

    /* Cards */
    .card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-header h3 {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-header h3 i {
      color: #8b5cf6;
    }

    /* Video Grid */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .video-card {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
    }

    .video-card:hover {
      border-color: #8b5cf6;
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(139, 92, 246, 0.2);
    }

    .video-card-thumbnail {
      position: relative;
      aspect-ratio: 16/9;
      background: #334155;
    }

    .video-card-thumbnail img,
    .video-card-thumbnail video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-card-play {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 56px;
      height: 56px;
      background: rgba(139, 92, 246, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .video-card:hover .video-card-play {
      opacity: 1;
    }

    .video-card-play i {
      color: white;
      font-size: 20px;
      margin-left: 4px;
    }

    .video-card-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .video-card-info {
      padding: 16px;
    }

    .video-card-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #64748b;
    }

    .video-card-actions {
      display: flex;
      gap: 8px;
    }

    .video-card-actions button {
      background: transparent;
      border: none;
      color: #64748b;
      cursor: pointer;
      padding: 4px;
      transition: color 0.2s;
    }

    .video-card-actions button:hover {
      color: #8b5cf6;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }

    .empty-state i {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #94a3b8;
    }

    .empty-state p {
      margin-bottom: 24px;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
    }

    .btn-secondary {
      background: #334155;
      color: #e2e8f0;
    }

    .btn-secondary:hover {
      background: #475569;
    }

    .btn-large {
      padding: 16px 32px;
      font-size: 16px;
    }

    /* Generator Section */
    .generator-section {
      display: none;
    }

    .generator-section.active {
      display: block;
    }

    /* Theme Buttons */
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .theme-btn {
      padding: 16px;
      background: #0f172a;
      border: 2px solid #334155;
      border-radius: 12px;
      color: #e2e8f0;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .theme-btn:hover {
      border-color: #8b5cf6;
      background: rgba(139, 92, 246, 0.1);
    }

    .theme-btn.selected {
      border-color: #8b5cf6;
      background: rgba(139, 92, 246, 0.2);
    }

    .theme-btn .emoji {
      font-size: 28px;
      display: block;
      margin-bottom: 8px;
    }

    /* Clips Grid */
    .clips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .clip-card {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      border: 2px solid #334155;
      transition: all 0.2s;
      cursor: pointer;
    }

    .clip-card:hover {
      border-color: #8b5cf6;
    }

    .clip-card.selected {
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3);
    }

    .clip-card img {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
    }

    .clip-card-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      font-size: 12px;
    }

    .clip-card-check {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: #22c55e;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .clip-card.selected .clip-card-check {
      display: flex;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #e2e8f0;
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      background: #0f172a;
      border: 2px solid #334155;
      border-radius: 10px;
      color: #e2e8f0;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-control:focus {
      outline: none;
      border-color: #8b5cf6;
    }

    .form-control::placeholder {
      color: #64748b;
    }

    /* Range Slider */
    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 5px;
      background: #334155;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #8b5cf6;
      cursor: pointer;
    }

    /* Progress */
    .progress-container {
      display: none;
    }

    .progress-container.active {
      display: block;
    }

    .progress-bar-wrapper {
      background: #334155;
      border-radius: 10px;
      height: 12px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-bar {
      background: linear-gradient(90deg, #ec4899 0%, #8b5cf6 100%);
      height: 100%;
      width: 0%;
      transition: width 0.3s;
    }

    .progress-text {
      text-align: center;
      color: #94a3b8;
      font-size: 14px;
    }

    /* Result */
    .result-container {
      display: none;
    }

    .result-container.active {
      display: block;
    }

    .result-video {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .result-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #1e293b;
      border-radius: 16px;
      max-width: 900px;
      width: 90%;
      max-height: 90vh;
      overflow: auto;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: #94a3b8;
      font-size: 24px;
      cursor: pointer;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-video {
      width: 100%;
      border-radius: 12px;
    }

    /* Search Row */
    .search-row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .search-row input {
      flex: 1;
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 20px;
    }

    .stat-card-value {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-card-label {
      color: #94a3b8;
      font-size: 14px;
      margin-top: 4px;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    .slide-up {
      animation: slideUp 0.4s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        border-right: none;
        border-bottom: 1px solid #334155;
      }

      .sidebar-nav {
        display: flex;
        overflow-x: auto;
        padding: 0;
      }

      .nav-item {
        padding: 12px 16px;
        border-left: none;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
      }

      .nav-item.active {
        border-bottom-color: #8b5cf6;
        border-left-color: transparent;
      }

      .sidebar-footer {
        display: none;
      }

      .main-content {
        margin-left: 0;
        padding: 20px;
      }
    }

    /* Media Picker Dark Theme Styles */
    .mp-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .mp-overlay.open { opacity: 1; }
    .mp-drawer {
      position: fixed;
      top: 0;
      right: -500px;
      width: 480px;
      max-width: 100vw;
      height: 100%;
      background: #0f172a;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      transition: right 0.25s ease-out;
      box-shadow: -8px 0 40px rgba(0,0,0,0.5);
      border-left: 1px solid #334155;
    }
    .mp-drawer.open { right: 0; }
    
    .mp-header {
      padding: 20px 24px;
      border-bottom: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #1e293b;
    }
    .mp-header h3 { 
      margin: 0; 
      font-size: 18px; 
      font-weight: 600;
      color: #e2e8f0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .mp-header h3::before {
      content: 'üé¨';
    }
    .mp-close {
      background: #334155;
      border: none;
      color: #94a3b8;
      font-size: 18px;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .mp-close:hover {
      background: #475569;
      color: #e2e8f0;
    }
    
    .mp-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #0f172a;
    }
    
    /* Tabs */
    .media-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #334155;
    }
    .media-tabs .tab-btn {
      padding: 10px 16px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #94a3b8;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .media-tabs .tab-btn:hover { 
      background: #334155; 
      color: #e2e8f0;
      border-color: #475569;
    }
    .media-tabs .tab-btn.active { 
      background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      color: white;
      border-color: transparent;
    }
    
    /* Search Row */
    .mp-row { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 16px; 
    }
    .mp-row input[type="text"],
    .mp-body input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 14px;
    }
    .mp-row input[type="text"]:focus,
    .mp-body input[type="text"]:focus {
      outline: none;
      border-color: #8b5cf6;
    }
    .mp-row input[type="text"]::placeholder,
    .mp-body input[type="text"]::placeholder {
      color: #64748b;
    }
    
    /* Buttons in MediaPicker */
    .mp-body .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }
    .mp-body .btn-primary {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      color: white;
    }
    .mp-body .btn-primary:hover {
      opacity: 0.9;
    }
    .mp-body .btn-success {
      background: #22c55e;
      color: white;
    }
    .mp-body .btn-lg {
      padding: 12px 20px;
    }
    
    /* Help text */
    .mp-help {
      color: #64748b;
      font-size: 13px;
      margin-top: 8px;
    }
    .mp-body .mp-help,
    .mp-body > div[style*="background: #f0fdf4"],
    .mp-body > div[style*="background: #fefce8"] {
      background: #1e293b !important;
      border-left-color: #8b5cf6 !important;
      color: #94a3b8 !important;
      border-radius: 8px;
      padding: 12px !important;
    }
    .mp-body > div[style*="background: #f0fdf4"] strong,
    .mp-body > div[style*="background: #fefce8"] strong {
      color: #a78bfa !important;
    }
    
    /* Grid */
    .pexels-grid,
    .storyblocks-grid,
    .unsplash-grid,
    .my-videos-grid {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 12px !important;
      margin-top: 16px;
    }
    
    /* Video tiles */
    .pexels-grid > div,
    .storyblocks-grid > div {
      background: #1e293b !important;
      border: 1px solid #334155 !important;
      border-radius: 10px !important;
      overflow: hidden;
      transition: all 0.2s !important;
    }
    .pexels-grid > div:hover,
    .storyblocks-grid > div:hover {
      border-color: #8b5cf6 !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2) !important;
    }
    
    /* Thumbnails */
    .mp-thumb {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .mp-thumb:hover { transform: scale(1.02); }
    
    /* Notes and counters */
    .pexels-note,
    .storyblocks-note,
    .unsplash-note {
      color: #64748b !important;
      font-size: 13px;
    }
    .pexels-selected-count,
    .storyblocks-selected-count {
      color: #a78bfa !important;
    }
    
    /* More row */
    .mp-more-row {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Tab content styling */
    .tab-content {
      color: #e2e8f0;
    }
    .tab-content p {
      color: #94a3b8;
    }
    
    /* File input styling */
    .tab-content input[type="file"] {
      background: #1e293b;
      border: 2px dashed #334155;
      border-radius: 8px;
      padding: 20px;
      width: 100%;
      color: #94a3b8;
    }
    
    /* Error messages */
    .mp-body div[style*="color:#c00"],
    .mp-body div[style*="color: #c00"] {
      color: #f87171 !important;
      background: rgba(239, 68, 68, 0.1);
      padding: 16px;
      border-radius: 8px;
      text-align: center;
    }
    
    /* Fix white area - override inline styles */
    .mp-body div[style*="background:#fff"],
    .mp-body div[style*="background: #fff"],
    .mp-body div[style*="background:white"],
    .mp-body div[style*="background: white"],
    .mp-body > div:first-child {
      background: transparent !important;
    }
    
    /* Tab content backgrounds */
    .tab-content[data-tab] {
      background: transparent !important;
    }
    
    /* Multi-select info box */
    .mp-body div[style*="border-left: 4px"] {
      background: #1e293b !important;
      border-left-color: #8b5cf6 !important;
      color: #94a3b8 !important;
      border-radius: 8px;
      padding: 12px 16px !important;
    }
    
    /* All buttons in MediaPicker */
    .mp-body button {
      background: #334155 !important;
      border: 1px solid #475569 !important;
      color: #e2e8f0 !important;
      border-radius: 8px !important;
      padding: 10px 16px !important;
      cursor: pointer;
      transition: all 0.2s;
    }
    .mp-body button:hover {
      background: #475569 !important;
    }
    .mp-body button.btn-primary,
    .mp-body button[style*="background: #667eea"],
    .mp-body button[style*="background:#667eea"] {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%) !important;
      border: none !important;
      color: white !important;
    }
    .mp-body button.btn-success,
    .mp-body button[style*="background: #22c55e"],
    .mp-body button[style*="background:#22c55e"],
    .mp-body button[style*="background: #10b981"] {
      background: #22c55e !important;
      border: none !important;
      color: white !important;
    }
    
    /* Search button specifically */
    .mp-body button[style*="background: #667eea"] {
      background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%) !important;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h1><i class="fas fa-video"></i> AI Travel Video</h1>
    </div>
    <div class="sidebar-nav">
      <div class="nav-item active" data-section="library">
        <i class="fas fa-film"></i>
        <span>Mijn Video's</span>
      </div>
      <div class="nav-item" data-section="generator">
        <i class="fas fa-magic"></i>
        <span>Nieuwe Video</span>
      </div>
      <div class="nav-item" data-section="settings">
        <i class="fas fa-cog"></i>
        <span>Instellingen</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <div>AI Travel Video v1.0</div>
      <div style="margin-top: 4px;">Powered by Shotstack & Pexels</div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Library Section -->
    <section id="library-section" class="section active">
      <div class="page-header">
        <h2>Mijn Video's</h2>
        <p>Bekijk en beheer je gegenereerde video's</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-value" id="totalVideos">0</div>
          <div class="stat-card-label">Totaal video's</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-value" id="totalDuration">0:00</div>
          <div class="stat-card-label">Totale duur</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-value" id="totalSize">0 MB</div>
          <div class="stat-card-label">Totale grootte</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-photo-video"></i> Video Bibliotheek</h3>
          <button class="btn btn-primary" onclick="VideoStudio.showSection('generator')">
            <i class="fas fa-plus"></i> Nieuwe Video
          </button>
        </div>
        <div id="videoGrid" class="video-grid">
          <div class="empty-state">
            <i class="fas fa-film"></i>
            <h3>Nog geen video's</h3>
            <p>Maak je eerste video met de AI Video Generator</p>
            <button class="btn btn-primary btn-large" onclick="VideoStudio.showSection('generator')">
              <i class="fas fa-magic"></i> Maak Video
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Generator Section -->
    <section id="generator-section" class="section" style="display: none;">
      <div class="page-header">
        <h2>Nieuwe Video Maken</h2>
        <p>Selecteer clips en genereer een professionele video</p>
      </div>

      <!-- Template Selector - Collapsible, Coming Soon -->
      <div class="card slide-up" style="border: 1px solid #334155; opacity: 0.7;">
        <div class="card-header" style="cursor: pointer;" onclick="VideoStudio.toggleSection('templateSection')">
          <h3 style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-palette"></i> Kies Video Stijl
            <span style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000; font-size: 10px; font-weight: 700; padding: 4px 10px; border-radius: 12px;">COMING SOON</span>
          </h3>
          <i class="fas fa-chevron-down" id="templateSectionIcon" style="color: #64748b; transition: transform 0.3s;"></i>
        </div>
        <div id="templateSection" style="display: none;">
          <p style="color: #94a3b8; margin-bottom: 20px;">
            Selecteer een template voor je video. Dit bepaalt de intro, overlays en algemene stijl.
          </p>
          <div id="templateGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px;">
          
          <!-- Luxe Template -->
          <div class="template-card" data-template="luxe" onclick="VideoStudio.selectTemplate('luxe')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #000; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">LUXE</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">‚ú®</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Luxe & Elegantie</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Stijlvolle overgangen, gouden accenten</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #fbbf24; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #1e293b; width: 16px; height: 16px; border-radius: 50%; border: 1px solid #fbbf24;"></span>
              <span style="background: #ffffff; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

          <!-- Avontuur Template -->
          <div class="template-card" data-template="adventure" onclick="VideoStudio.selectTemplate('adventure')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">ACTIEF</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">üèîÔ∏è</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Avontuur</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Dynamisch, energiek, snelle cuts</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #22c55e; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #0f172a; width: 16px; height: 16px; border-radius: 50%; border: 1px solid #22c55e;"></span>
              <span style="background: #f97316; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

          <!-- Familie Template -->
          <div class="template-card" data-template="family" onclick="VideoStudio.selectTemplate('family')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">FAMILIE</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Familie</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Warm, vriendelijk, zachte kleuren</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #ec4899; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #fce7f3; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #8b5cf6; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

          <!-- Romantisch Template -->
          <div class="template-card" data-template="romantic" onclick="VideoStudio.selectTemplate('romantic')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">ROMANTIEK</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">üíï</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Romantisch</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Dromerig, slow-motion, warm</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #f43f5e; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #fda4af; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #7c3aed; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

          <!-- Zakelijk Template -->
          <div class="template-card" data-template="business" onclick="VideoStudio.selectTemplate('business')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">ZAKELIJK</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">üíº</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Zakelijk</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Professioneel, strak, minimalistisch</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #3b82f6; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #1e293b; width: 16px; height: 16px; border-radius: 50%; border: 1px solid #3b82f6;"></span>
              <span style="background: #e2e8f0; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

          <!-- Tropisch Template -->
          <div class="template-card" data-template="tropical" onclick="VideoStudio.selectTemplate('tropical')" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #334155; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 0; right: 0; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: #fff; font-size: 10px; font-weight: 700; padding: 4px 12px; border-radius: 0 10px 0 10px;">TROPISCH</div>
            <div style="font-size: 48px; text-align: center; margin-bottom: 12px;">üèùÔ∏è</div>
            <h4 style="margin: 0 0 8px 0; color: #e2e8f0; font-size: 16px; text-align: center;">Tropisch</h4>
            <p style="margin: 0; color: #64748b; font-size: 12px; text-align: center;">Zonnig, relaxed, felle kleuren</p>
            <div style="margin-top: 12px; display: flex; gap: 4px; justify-content: center;">
              <span style="background: #06b6d4; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #fbbf24; width: 16px; height: 16px; border-radius: 50%;"></span>
              <span style="background: #22c55e; width: 16px; height: 16px; border-radius: 50%;"></span>
            </div>
          </div>

        </div>
        <div id="selectedTemplateInfo" style="margin-top: 20px; padding: 16px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; display: none;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-check-circle" style="color: #22c55e; font-size: 24px;"></i>
            <div>
              <div style="font-weight: 600; color: #e2e8f0;">Template geselecteerd: <span id="selectedTemplateName">-</span></div>
              <div style="font-size: 13px; color: #94a3b8;">Je kunt dit later nog wijzigen</div>
            </div>
          </div>
        </div>
        </div>
      </div>

      <!-- Rondreis Planner Import -->
      <div class="card slide-up" style="border: 2px solid #8b5cf6; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);">
        <div class="card-header">
          <h3><i class="fas fa-download"></i> Rondreis Planner Import</h3>
        </div>
        <p style="color: #94a3b8; margin-bottom: 16px;">
          Heb je een reis in Rondreis Planner? Importeer de bestemmingen automatisch!
        </p>
        <div class="search-row">
          <input type="text" id="travelIdInput" class="form-control" placeholder="Rondreis Planner ID (bijv. abc123)">
          <button class="btn btn-primary" onclick="VideoStudio.importTravelId()">
            <i class="fas fa-download"></i> Importeren
          </button>
        </div>
        <div id="importStatus" style="margin-top: 12px; font-size: 14px;"></div>
        <div id="importedDestinations" style="margin-top: 16px; display: none;">
          <label style="font-weight: 600; margin-bottom: 8px; display: block;">Ge√Ømporteerde bestemmingen:</label>
          <div id="destinationTags" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>
      </div>

      <!-- Step 1: Title & Theme - Collapsible -->
      <div class="card slide-up">
        <div class="card-header" style="cursor: pointer;" onclick="VideoStudio.toggleSection('titleThemeSection')">
          <h3 style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-heading"></i> Of: Handmatig Invoeren
            <span style="color: #64748b; font-size: 12px; font-weight: 400;">(titel, thema & zoeken)</span>
          </h3>
          <i class="fas fa-chevron-down" id="titleThemeSectionIcon" style="color: #64748b; transition: transform 0.3s;"></i>
        </div>
        <div id="titleThemeSection" style="display: none;">
        <div class="form-group">
          <label>Video Titel</label>
          <input type="text" id="videoTitle" class="form-control" placeholder="Bijv. Mijn Vakantie Video, Roadtrip 2024..." value="Mijn Video">
        </div>
        <div class="form-group">
          <label>Kies een thema</label>
          <div class="theme-grid">
            <button class="theme-btn" data-theme="safari wildlife africa">
              <span class="emoji">ü¶Å</span>
              Safari
            </button>
            <button class="theme-btn" data-theme="skiing snow mountains winter">
              <span class="emoji">‚õ∑Ô∏è</span>
              Ski√´n
            </button>
            <button class="theme-btn" data-theme="hiking mountains trail nature">
              <span class="emoji">ü•æ</span>
              Hiking
            </button>
            <button class="theme-btn" data-theme="mountain biking cycling trail">
              <span class="emoji">üöµ</span>
              Mountain Bike
            </button>
            <button class="theme-btn" data-theme="cruise ship ocean sailing">
              <span class="emoji">üö¢</span>
              Cruise
            </button>
            <button class="theme-btn" data-theme="road trip car driving highway">
              <span class="emoji">üöó</span>
              Roadtrip
            </button>
            <button class="theme-btn" data-theme="tropical beach paradise ocean">
              <span class="emoji">üèùÔ∏è</span>
              Tropisch
            </button>
            <button class="theme-btn" data-theme="city urban architecture skyline">
              <span class="emoji">üèôÔ∏è</span>
              Stad
            </button>
            <button class="theme-btn" data-theme="food cooking restaurant cuisine">
              <span class="emoji">üçΩÔ∏è</span>
              Food
            </button>
            <button class="theme-btn" data-theme="sunset sunrise golden hour">
              <span class="emoji">üåÖ</span>
              Sunset
            </button>
            <button class="theme-btn" data-theme="drone aerial landscape view">
              <span class="emoji">üöÅ</span>
              Drone
            </button>
            <button class="theme-btn" data-theme="nature forest trees green">
              <span class="emoji">üå≤</span>
              Natuur
            </button>
          </div>
        </div>
        <div class="form-group">
          <label>Of zoek zelf</label>
          <div class="search-row">
            <input type="text" id="customSearch" class="form-control" placeholder="Bijv. Amsterdam, Paris, beach sunset...">
            <button class="btn btn-primary" onclick="VideoStudio.searchClips()">
              <i class="fas fa-search"></i> Zoeken
            </button>
          </div>
        </div>
        </div>
      </div>

      <!-- Step 2: Select Clips per Destination -->
      <div class="card slide-up">
        <div class="card-header">
          <h3><i class="fas fa-film"></i> Stap 2: Video Clips per Bestemming</h3>
          <span id="selectedCount" style="color: #22c55e; font-weight: 600;">0 clips geselecteerd</span>
        </div>
        
        <!-- Destinations Grid -->
        <div id="destinationsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
          <!-- Destinations will be rendered here -->
        </div>
        
        <!-- Add Destination Button -->
        <div id="addDestinationCard" style="border: 2px dashed #475569; border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s;" onclick="VideoStudio.addDestination()">
          <i class="fas fa-plus-circle" style="font-size: 32px; color: #8b5cf6; margin-bottom: 8px;"></i>
          <div style="font-weight: 600; color: #e2e8f0;">Voeg bestemming toe</div>
          <div style="font-size: 12px; color: #64748b; margin-top: 4px;">Handmatig een gebied toevoegen</div>
        </div>
      </div>

      <!-- Step 3: Settings -->
      <div class="card slide-up">
        <div class="card-header">
          <h3><i class="fas fa-sliders-h"></i> Stap 3: Instellingen</h3>
        </div>
        <div class="form-group">
          <label>Duur per clip: <span id="durationValue">7</span> seconden</label>
          <input type="range" id="clipDuration" min="2" max="15" value="7" step="0.5">
        </div>
        
        <!-- Overlay Settings (only show when travelData is available) -->
        <div id="overlaySettings" style="display: none; margin-top: 20px; padding: 16px; background: rgba(139, 92, 246, 0.1); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.3);">
          <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: #a78bfa; font-weight: 600;">
            <i class="fas fa-layer-group"></i> Travel Info Overlays
          </label>
          <div style="display: flex; flex-wrap: wrap; gap: 16px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="showHotelOverlay" checked style="width: 18px; height: 18px; accent-color: #8b5cf6;">
              <span>üè® Hotel info tonen</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="showFlightOverlay" checked style="width: 18px; height: 18px; accent-color: #8b5cf6;">
              <span>‚úàÔ∏è Vlucht info tonen</span>
            </label>
          </div>
          <div class="form-group" style="margin-top: 16px; margin-bottom: 0;">
            <label>Overlay duur: <span id="overlayDurationValue">40</span>% van clip</label>
            <input type="range" id="overlayDuration" min="20" max="50" value="40" step="5">
          </div>
        </div>
        
        <div class="form-group" style="margin-top: 20px;">
          <label>Voice-over (optioneel)</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="file" id="voiceoverInput" accept="audio/*" style="display: none;">
            <button class="btn btn-secondary" onclick="document.getElementById('voiceoverInput').click()">
              <i class="fas fa-microphone"></i> Upload Audio
            </button>
            <span id="voiceoverStatus" style="color: #94a3b8; font-size: 14px;"></span>
          </div>
        </div>
      </div>

      <!-- Generate Button -->
      <div style="text-align: center; margin: 32px 0;">
        <button id="generateBtn" class="btn btn-primary btn-large" onclick="VideoStudio.generateVideo()">
          <i class="fas fa-magic"></i> Genereer Video
        </button>
      </div>

      <!-- Progress -->
      <div id="progressContainer" class="card progress-container">
        <div class="card-header">
          <h3><i class="fas fa-spinner fa-spin"></i> Video wordt gegenereerd...</h3>
        </div>
        <div class="progress-bar-wrapper">
          <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="progressText" class="progress-text">Voorbereiden...</div>
      </div>

      <!-- Result -->
      <div id="resultContainer" class="card result-container">
        <div class="card-header">
          <h3 style="color: #22c55e;"><i class="fas fa-check-circle"></i> Video is klaar!</h3>
        </div>
        <video id="resultVideo" class="result-video" controls></video>
        <div class="form-group">
          <label>Video naam voor opslag</label>
          <input type="text" id="saveVideoName" class="form-control" placeholder="Naam voor je video">
        </div>
        <div class="result-actions">
          <button class="btn btn-primary" onclick="VideoStudio.saveVideo()">
            <i class="fas fa-save"></i> Opslaan naar Bibliotheek
          </button>
          <a id="downloadBtn" class="btn btn-secondary" download>
            <i class="fas fa-download"></i> Download
          </a>
          <button class="btn btn-secondary" onclick="VideoStudio.resetGenerator()">
            <i class="fas fa-redo"></i> Nieuwe Video
          </button>
        </div>
        <div id="saveStatus" style="margin-top: 12px; font-size: 14px;"></div>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings-section" class="section" style="display: none;">
      <div class="page-header">
        <h2>Instellingen</h2>
        <p>AI Travel Video configuratie</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-key"></i> API Configuratie</h3>
        </div>
        <div style="background: #0f172a; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <p style="color: #22c55e; margin-bottom: 12px;">
            <i class="fas fa-check-circle"></i> <strong>Server-side API keys actief</strong>
          </p>
          <p style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;">
            De volgende API's zijn geconfigureerd in Vercel:
          </p>
          <ul style="color: #94a3b8; font-size: 14px; margin-left: 20px; line-height: 1.8;">
            <li><strong>Pexels</strong> - Video clips zoeken</li>
            <li><strong>Shotstack</strong> - Video rendering</li>
            <li><strong>Storyblocks</strong> - Premium video's</li>
            <li><strong>Unsplash</strong> - Afbeeldingen</li>
            <li><strong>Blob Storage</strong> - Video opslag</li>
          </ul>
        </div>
        <p style="color: #64748b; font-size: 13px;">
          <i class="fas fa-info-circle"></i> API keys worden beheerd in de Vercel dashboard onder Environment Variables.
        </p>
      </div>

      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-database"></i> Video Opslag</h3>
        </div>
        <p style="color: #94a3b8; margin-bottom: 16px;">
          Video's worden automatisch opgeslagen in Vercel Blob Storage wanneer je op "Opslaan naar Bibliotheek" klikt.
        </p>
        <div style="display: flex; gap: 12px;">
          <button class="btn btn-secondary" onclick="VideoStudio.loadVideos(); VideoStudio.showSection('library');">
            <i class="fas fa-sync-alt"></i> Ververs Bibliotheek
          </button>
          <button class="btn btn-secondary" onclick="VideoStudio.clearCache()">
            <i class="fas fa-trash"></i> Cache Wissen
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3><i class="fas fa-info-circle"></i> Over AI Travel Video</h3>
        </div>
        <div style="color: #94a3b8; font-size: 14px; line-height: 1.8;">
          <p><strong>AI Travel Video v1.0</strong></p>
          <p>Standalone video generator voor het maken van professionele promotievideo's.</p>
          <br>
          <p><strong>Features:</strong></p>
          <ul style="margin-left: 20px;">
            <li>Travel Compositor import</li>
            <li>12+ thema's voor video clips</li>
            <li>Pexels & Storyblocks integratie</li>
            <li>Voice-over ondersteuning</li>
            <li>Automatische video opslag</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Video Preview Modal -->
  <div id="videoModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">Video Preview</h3>
        <button class="modal-close" onclick="VideoStudio.closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <video id="modalVideo" class="modal-video" controls></video>
        <div style="margin-top: 16px; display: flex; gap: 12px;">
          <a id="modalDownload" class="btn btn-primary" download>
            <i class="fas fa-download"></i> Download
          </a>
          <button class="btn btn-secondary" onclick="VideoStudio.deleteVideo()">
            <i class="fas fa-trash"></i> Verwijderen
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Video Studio App
    const VideoStudio = {
      videos: [],
      selectedClips: [],
      currentVideoId: null,
      voiceoverUrl: null,
      renderId: null,
      statusInterval: null,
      selectedTemplate: null,
      selectedTheme: null,
      selectedThemeName: null,
      
      // Template configurations
      templates: {
        luxe: {
          name: 'Luxe & Elegantie',
          colors: { primary: '#fbbf24', secondary: '#1e293b', accent: '#ffffff' },
          titleStyle: 'future',
          transition: 'fade',
          overlayPosition: 'bottomRight'
        },
        adventure: {
          name: 'Avontuur',
          colors: { primary: '#22c55e', secondary: '#0f172a', accent: '#f97316' },
          titleStyle: 'chunk',
          transition: 'slideLeft',
          overlayPosition: 'bottomLeft'
        },
        family: {
          name: 'Familie',
          colors: { primary: '#ec4899', secondary: '#fce7f3', accent: '#8b5cf6' },
          titleStyle: 'minimal',
          transition: 'fade',
          overlayPosition: 'bottom'
        },
        romantic: {
          name: 'Romantisch',
          colors: { primary: '#f43f5e', secondary: '#fda4af', accent: '#7c3aed' },
          titleStyle: 'subtitle',
          transition: 'fade',
          overlayPosition: 'center'
        },
        business: {
          name: 'Zakelijk',
          colors: { primary: '#3b82f6', secondary: '#1e293b', accent: '#e2e8f0' },
          titleStyle: 'minimal',
          transition: 'fade',
          overlayPosition: 'topRight'
        },
        tropical: {
          name: 'Tropisch',
          colors: { primary: '#06b6d4', secondary: '#fbbf24', accent: '#22c55e' },
          titleStyle: 'chunk',
          transition: 'slideRight',
          overlayPosition: 'bottomLeft'
        }
      },

      // Current user context (from BOLT deeplink)
      currentUserId: null,

      init() {
        // Check for deeplink parameters
        this.handleDeeplink();
        
        // Parse URL parameters for deeplink support
        this.parseDeeplinkParams();
        
        // Setup navigation
        document.querySelectorAll('.nav-item').forEach(item => {
          item.addEventListener('click', () => {
            const section = item.dataset.section;
            this.showSection(section);
          });
        });

        // Setup theme buttons - fill search field with theme keywords
        document.querySelectorAll('.theme-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            const theme = btn.dataset.theme; // e.g. "drone aerial landscape view"
            this.selectedTheme = theme;
            this.selectedThemeName = btn.textContent.trim();
            
            // Fill search field with theme keywords - agent can add location
            const searchInput = document.getElementById('customSearch');
            searchInput.value = theme + ' ';
            searchInput.focus(); // Focus so agent can type location
            
            console.log('[VideoStudio] Theme selected:', this.selectedThemeName);
          });
        });

        // Setup duration slider
        const durationSlider = document.getElementById('clipDuration');
        const durationValue = document.getElementById('durationValue');
        durationSlider.addEventListener('input', () => {
          durationValue.textContent = durationSlider.value;
        });

        // Setup overlay duration slider
        const overlaySlider = document.getElementById('overlayDuration');
        const overlayValue = document.getElementById('overlayDurationValue');
        if (overlaySlider && overlayValue) {
          overlaySlider.addEventListener('input', () => {
            overlayValue.textContent = overlaySlider.value;
          });
        }

        // Setup voiceover upload
        document.getElementById('voiceoverInput').addEventListener('change', (e) => {
          this.handleVoiceoverUpload(e);
        });

        // Setup custom search enter key
        document.getElementById('customSearch').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.searchClips();
        });

        // Setup travel ID import enter key
        document.getElementById('travelIdInput').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') this.importTravelId();
        });

        // Load videos and render initial destinations
        this.loadVideos();
        this.renderDestinations();

        // Auto-import if travelId was provided via deeplink
        if (this.pendingTravelId) {
          document.getElementById('travelIdInput').value = this.pendingTravelId;
          this.importTravelId();
          this.pendingTravelId = null;
        }
      },

      // BOLT integration config
      boltConfig: {
        apiUrl: null,
        brandId: null,
        token: null,
        apiKey: null,
        mode: 'new',
        tripId: null,
        agentId: null
      },

      // Parse deeplink URL parameters from BOLT
      parseDeeplinkParams() {
        const params = new URLSearchParams(window.location.search);
        const hash = window.location.hash; // e.g. #/mode/video/new
        
        // === BOLT Integration Parameters ===
        // API endpoint for BOLT backend
        const apiUrl = params.get('api');
        if (apiUrl) {
          this.boltConfig.apiUrl = apiUrl;
          console.log('[VideoStudio] BOLT API URL:', apiUrl);
        }

        // Brand ID (used for user isolation in BOLT)
        const brandId = params.get('brand_id');
        if (brandId) {
          this.boltConfig.brandId = brandId;
          this.currentUserId = brandId; // Use brand_id for video isolation
          console.log('[VideoStudio] BOLT Brand ID:', brandId);
        }

        // JWT Token for authentication
        const token = params.get('token');
        if (token) {
          this.boltConfig.token = token;
          console.log('[VideoStudio] BOLT JWT token received');
        }

        // API Key
        const apiKey = params.get('apikey');
        if (apiKey) {
          this.boltConfig.apiKey = apiKey;
          console.log('[VideoStudio] BOLT API key received');
        }

        // Parse hash for mode: #/mode/video/new, #/mode/video/edit, #/mode/video/trip
        if (hash) {
          const modeMatch = hash.match(/#\/mode\/video\/(\w+)/);
          if (modeMatch) {
            this.boltConfig.mode = modeMatch[1]; // 'new', 'edit', or 'trip'
            console.log('[VideoStudio] BOLT mode:', this.boltConfig.mode);
          }
        }

        // Trip ID (for trip mode)
        const tripId = params.get('trip_id') || params.get('tripId');
        if (tripId) {
          this.boltConfig.tripId = tripId;
          this.pendingTravelId = tripId; // Auto-import trip
          console.log('[VideoStudio] BOLT Trip ID:', tripId);
        }

        // Agent ID
        const agentId = params.get('agent_id') || params.get('agentId');
        if (agentId) {
          this.boltConfig.agentId = agentId;
          console.log('[VideoStudio] BOLT Agent ID:', agentId);
        }

        // === Legacy/Simple Parameters (backwards compatibility) ===
        // User ID for video isolation (fallback if no brand_id)
        if (!this.currentUserId) {
          const userId = params.get('userId') || params.get('user_id');
          if (userId) {
            this.currentUserId = userId;
            console.log('[VideoStudio] User context set:', userId);
          }
        }

        // Travel ID for auto-import (fallback if no trip_id)
        if (!this.pendingTravelId) {
          const travelId = params.get('travelId') || params.get('travel_id') || params.get('ideaId');
          if (travelId) {
            this.pendingTravelId = travelId;
            console.log('[VideoStudio] Will auto-import travel:', travelId);
          }
        }

        // Template pre-selection
        const template = params.get('template');
        if (template && this.templates[template]) {
          setTimeout(() => this.selectTemplate(template), 100);
          console.log('[VideoStudio] Template pre-selected:', template);
        }

        // Auto-navigate to generator section
        const section = params.get('section') || (this.pendingTravelId ? 'generator' : null);
        if (section) {
          setTimeout(() => this.showSection(section), 50);
        }

        // If BOLT mode is set, always go to generator
        if (this.boltConfig.mode) {
          setTimeout(() => this.showSection('generator'), 50);
        }

        // Log full config for debugging
        if (this.boltConfig.apiUrl || this.boltConfig.brandId) {
          console.log('[VideoStudio] BOLT Config:', this.boltConfig);
        }
      },

      selectTemplate(templateId) {
        this.selectedTemplate = templateId;
        const template = this.templates[templateId];
        
        // Update UI - remove selection from all cards
        document.querySelectorAll('.template-card').forEach(card => {
          card.style.borderColor = '#334155';
          card.style.transform = 'scale(1)';
        });
        
        // Highlight selected card
        const selectedCard = document.querySelector(`.template-card[data-template="${templateId}"]`);
        if (selectedCard) {
          selectedCard.style.borderColor = '#8b5cf6';
          selectedCard.style.transform = 'scale(1.02)';
        }
        
        // Show selection info
        document.getElementById('selectedTemplateInfo').style.display = 'block';
        document.getElementById('selectedTemplateName').textContent = template.name;
        
        console.log('[VideoStudio] Template selected:', templateId, template);
      },

      showSection(section) {
        // Update nav
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.section === section);
        });

        // Update sections
        document.querySelectorAll('.section').forEach(sec => {
          sec.style.display = 'none';
        });
        document.getElementById(`${section}-section`).style.display = 'block';

        // Reload videos when showing library
        if (section === 'library') {
          this.loadVideos();
        }
      },

      clearCache() {
        localStorage.removeItem('videoStudioCache');
        alert('Cache gewist!');
      },

      async loadVideos() {
        const grid = document.getElementById('videoGrid');
        grid.innerHTML = '<div style="text-align: center; padding: 40px; color: #94a3b8;"><i class="fas fa-spinner fa-spin" style="font-size: 32px;"></i><p style="margin-top: 12px;">Laden...</p></div>';

        try {
          // Include userId for user-isolated video list
          const url = this.currentUserId 
            ? `/api/videos/list?userId=${encodeURIComponent(this.currentUserId)}`
            : '/api/videos/list';
          const response = await fetch(url);
          const data = await response.json();

          if (data.success && data.videos && data.videos.length > 0) {
            this.videos = data.videos;
            this.renderVideos();
            this.updateStats();
          } else {
            grid.innerHTML = `
              <div class="empty-state">
                <i class="fas fa-film"></i>
                <h3>Nog geen video's</h3>
                <p>Maak je eerste video met de AI Video Generator</p>
                <button class="btn btn-primary btn-large" onclick="VideoStudio.showSection('generator')">
                  <i class="fas fa-magic"></i> Maak Video
                </button>
              </div>
            `;
          }
        } catch (error) {
          console.error('Load videos error:', error);
          grid.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <h3>Fout bij laden</h3>
              <p>${error.message}</p>
              <button class="btn btn-secondary" onclick="VideoStudio.loadVideos()">
                <i class="fas fa-redo"></i> Opnieuw proberen
              </button>
            </div>
          `;
        }
      },

      renderVideos() {
        const grid = document.getElementById('videoGrid');
        
        if (this.videos.length === 0) {
          grid.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-film"></i>
              <h3>Nog geen video's</h3>
              <p>Maak je eerste video met de AI Video Generator</p>
              <button class="btn btn-primary btn-large" onclick="VideoStudio.showSection('generator')">
                <i class="fas fa-magic"></i> Maak Video
              </button>
            </div>
          `;
          return;
        }

        grid.innerHTML = this.videos.map(video => `
          <div class="video-card" onclick="VideoStudio.openVideo('${video.id}')">
            <div class="video-card-thumbnail">
              <img src="${video.thumbnail || video.videoUrl}" alt="${video.title}" onerror="this.style.display='none'">
              <div class="video-card-play">
                <i class="fas fa-play"></i>
              </div>
              ${video.duration ? `<div class="video-card-duration">${this.formatDuration(video.duration)}</div>` : ''}
            </div>
            <div class="video-card-info">
              <div class="video-card-title">${video.title}</div>
              <div class="video-card-meta">
                <span>${this.formatDate(video.createdAt)}</span>
                <div class="video-card-actions">
                  <button onclick="event.stopPropagation(); VideoStudio.downloadVideo('${video.videoUrl}', '${video.title}')" title="Download">
                    <i class="fas fa-download"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      },

      updateStats() {
        document.getElementById('totalVideos').textContent = this.videos.length;
        
        const totalDuration = this.videos.reduce((sum, v) => sum + (v.duration || 0), 0);
        document.getElementById('totalDuration').textContent = this.formatDuration(totalDuration);
        
        const totalSize = this.videos.reduce((sum, v) => sum + (v.size || 0), 0);
        document.getElementById('totalSize').textContent = this.formatSize(totalSize);
      },

      formatDuration(seconds) {
        if (!seconds) return '0:00';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      },

      formatDate(dateStr) {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        return date.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' });
      },

      formatSize(bytes) {
        if (!bytes) return '0 MB';
        const mb = bytes / (1024 * 1024);
        return mb.toFixed(1) + ' MB';
      },

      openVideo(videoId) {
        const video = this.videos.find(v => v.id === videoId);
        if (!video) return;

        this.currentVideoId = videoId;
        document.getElementById('modalTitle').textContent = video.title;
        document.getElementById('modalVideo').src = video.videoUrl;
        document.getElementById('modalDownload').href = video.videoUrl;
        document.getElementById('modalDownload').download = `${video.title}.mp4`;
        document.getElementById('videoModal').classList.add('active');
      },

      closeModal() {
        document.getElementById('videoModal').classList.remove('active');
        document.getElementById('modalVideo').pause();
        this.currentVideoId = null;
      },

      downloadVideo(url, title) {
        const a = document.createElement('a');
        a.href = url;
        a.download = `${title}.mp4`;
        a.click();
      },

      async deleteVideo() {
        if (!this.currentVideoId) return;
        
        if (!confirm('Weet je zeker dat je deze video wilt verwijderen?')) return;

        const video = this.videos.find(v => v.id === this.currentVideoId);
        if (!video) return;

        try {
          // Try to delete from Blob storage
          const response = await fetch('/api/videos/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ videoUrl: video.videoUrl, videoId: video.id })
          });

          if (!response.ok) {
            console.warn('Could not delete from storage, removing from local list only');
          }
        } catch (error) {
          console.warn('Delete API error:', error);
        }

        // Remove from local list
        this.videos = this.videos.filter(v => v.id !== this.currentVideoId);
        this.closeModal();
        this.renderVideos();
        this.updateStats();
      },

      async searchClips(query) {
        const searchInput = document.getElementById('customSearch');
        const searchQuery = query || searchInput.value.trim();
        
        if (!searchQuery) {
          alert('Voer een zoekterm in');
          return;
        }

        // Extract destination name from search query (last word or after theme keywords)
        let destName = searchQuery;
        if (this.selectedTheme && searchQuery.startsWith(this.selectedTheme)) {
          destName = searchQuery.replace(this.selectedTheme, '').trim() || this.selectedThemeName || 'Bestemming';
        }
        
        // Add destination if not exists
        let destIndex = this.destinations.findIndex(d => d.name === destName);
        if (destIndex === -1) {
          this.destinations.push({ 
            name: destName, 
            searchQuery: searchQuery 
          });
          destIndex = this.destinations.length - 1;
          this.renderDestinations();
        }
        
        // Open MediaPicker with the search query
        this.openClipSearchWithQuery(destIndex, searchQuery);
      },

      renderClips(videos) {
        const grid = document.getElementById('clipsGrid');
        
        grid.innerHTML = videos.map(video => {
          const hdFile = video.video_files.find(f => f.quality === 'hd' && f.width >= 1280) || video.video_files[0];
          const isSelected = this.selectedClips.some(c => c.id === video.id);
          
          return `
            <div class="clip-card ${isSelected ? 'selected' : ''}" data-id="${video.id}" onclick="VideoStudio.toggleClip(${video.id}, '${hdFile.link}', '${video.image}', ${video.duration})">
              <img src="${video.image}" alt="">
              <div class="clip-card-overlay">
                ${Math.round(video.duration)}s
              </div>
              <div class="clip-card-check">
                <i class="fas fa-check" style="color: white; font-size: 12px;"></i>
              </div>
            </div>
          `;
        }).join('');
      },

      toggleClip(id, url, thumbnail, duration) {
        const index = this.selectedClips.findIndex(c => c.id === id);
        
        if (index >= 0) {
          this.selectedClips.splice(index, 1);
        } else {
          this.selectedClips.push({ id, url, thumbnail, duration });
        }

        // Update UI
        const card = document.querySelector(`.clip-card[data-id="${id}"]`);
        if (card) {
          card.classList.toggle('selected', index < 0);
        }

        document.getElementById('selectedCount').textContent = `${this.selectedClips.length} clips geselecteerd`;
      },

      async handleVoiceoverUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        const status = document.getElementById('voiceoverStatus');
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploaden...';

        try {
          const formData = new FormData();
          formData.append('voiceover', file);

          const response = await fetch('/api/video/upload-voiceover', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) throw new Error('Upload mislukt');

          const result = await response.json();
          this.voiceoverUrl = result.url;
          status.innerHTML = `<i class="fas fa-check-circle" style="color: #22c55e;"></i> ${file.name}`;
        } catch (error) {
          console.error('Voiceover upload error:', error);
          status.innerHTML = `<i class="fas fa-exclamation-circle" style="color: #ef4444;"></i> Upload mislukt`;
        }
      },

      async generateVideo() {
        if (this.selectedClips.length === 0) {
          alert('Selecteer eerst video clips voor je bestemmingen');
          return;
        }

        const title = document.getElementById('videoTitle').value.trim() || 'Mijn Video';
        const clipDuration = parseFloat(document.getElementById('clipDuration').value);
        
        // Get overlay settings
        const showHotelOverlay = document.getElementById('showHotelOverlay')?.checked ?? true;
        const showFlightOverlay = document.getElementById('showFlightOverlay')?.checked ?? true;
        const overlayDurationPercent = parseInt(document.getElementById('overlayDuration')?.value || '40');
        const overlayDuration = overlayDurationPercent / 100; // Convert to decimal

        // Show progress
        document.getElementById('progressContainer').classList.add('active');
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('generateBtn').style.opacity = '0.5';

        try {
          // Build payload with clips organized by destination
          const payload = {
            destinations: this.destinations.map(d => ({ 
              name: d.name,
              overlayText: d.overlayText || d.name,
              hotelInfo: d.hotelInfo || ''
            })),
            clips: this.selectedClips.map(clip => ({
              url: clip.url,
              destination: clip.destinationName || 'Clip',
              duration: clip.duration,
              thumbnail: clip.thumbnail
            })),
            title: title,
            voiceoverUrl: this.voiceoverUrl,
            clipDuration: clipDuration,
            travelData: this.travelData,  // Include full TC data for overlays
            showHotelOverlay: showHotelOverlay,
            showFlightOverlay: showFlightOverlay,
            overlayDuration: overlayDuration,
            template: this.selectedTemplate,
            templateConfig: this.selectedTemplate ? this.templates[this.selectedTemplate] : null
          };

          const response = await fetch('/api/video/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || 'Video generatie mislukt');
          }

          const result = await response.json();
          this.renderId = result.renderId;

          // Start polling
          this.pollStatus();

        } catch (error) {
          console.error('Generate error:', error);
          alert('Fout: ' + error.message);
          this.resetGenerator();
        }
      },

      pollStatus() {
        this.statusInterval = setInterval(async () => {
          try {
            const response = await fetch(`/api/video/status/${this.renderId}`);
            const status = await response.json();

            document.getElementById('progressBar').style.width = `${status.progress}%`;
            document.getElementById('progressText').textContent = status.message;

            if (status.status === 'done') {
              clearInterval(this.statusInterval);
              this.showResult(status.url);
            } else if (status.status === 'failed') {
              clearInterval(this.statusInterval);
              alert('Video generatie mislukt: ' + (status.error || 'Onbekende fout'));
              this.resetGenerator();
            }
          } catch (error) {
            console.error('Status check error:', error);
          }
        }, 3000);
      },

      showResult(videoUrl) {
        document.getElementById('progressContainer').classList.remove('active');
        document.getElementById('resultContainer').classList.add('active');
        document.getElementById('resultVideo').src = videoUrl;
        document.getElementById('downloadBtn').href = videoUrl;
        document.getElementById('saveVideoName').value = document.getElementById('videoTitle').value;
      },

      async saveVideo() {
        const videoElement = document.getElementById('resultVideo');
        const videoName = document.getElementById('saveVideoName').value.trim() || 'Untitled Video';
        const saveStatus = document.getElementById('saveStatus');

        if (!videoElement.src) {
          saveStatus.innerHTML = '<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> Geen video om op te slaan</span>';
          return;
        }

        saveStatus.innerHTML = '<span style="color: #94a3b8;"><i class="fas fa-spinner fa-spin"></i> Opslaan...</span>';

        try {
          // Fetch video as blob
          const videoBlob = await fetch(videoElement.src).then(r => r.blob());
          
          // Convert to base64
          const base64Video = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(videoBlob);
          });

          // Upload to storage (include userId for user isolation)
          const response = await fetch('/api/videos/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              videoData: base64Video,
              title: videoName,
              type: 'ai-generated',
              duration: videoElement.duration || 0,
              width: videoElement.videoWidth || 1920,
              height: videoElement.videoHeight || 1080,
              userId: this.currentUserId
            })
          });

          if (!response.ok) {
            let errorMsg = 'Upload mislukt';
            try {
              const error = await response.json();
              errorMsg = error.error || error.detail || errorMsg;
            } catch (e) {
              const text = await response.text();
              console.error('[VideoStudio] Non-JSON error response:', text);
              errorMsg = text.substring(0, 100) || `HTTP ${response.status}`;
            }
            throw new Error(errorMsg);
          }

          let result;
          try {
            result = await response.json();
          } catch (e) {
            const text = await response.text();
            console.error('[VideoStudio] Non-JSON success response:', text);
            throw new Error('Server gaf geen geldige response');
          }
          
          // Also save metadata to BOLT/Supabase if we have a brand_id
          if (this.brandId && result.url) {
            try {
              console.log('[VideoStudio] Saving video metadata to BOLT...');
              const boltResponse = await fetch('/api/videos/save-to-bolt', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  brand_id: this.brandId,
                  trip_id: this.boltConfig?.tripId || null,
                  title: videoName,
                  video_url: result.url,
                  thumbnail_url: result.thumbnail || null,
                  duration: videoElement.duration || 0,
                  width: videoElement.videoWidth || 1920,
                  height: videoElement.videoHeight || 1080,
                  template: this.selectedTemplate || null,
                  theme: this.selectedThemeName || null,
                  file_size: result.size || null
                })
              });
              
              if (boltResponse.ok) {
                console.log('[VideoStudio] Video metadata saved to BOLT');
                saveStatus.innerHTML = '<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> Video opgeslagen in BOLT!</span>';
              } else {
                console.warn('[VideoStudio] Failed to save to BOLT, but video is saved locally');
                saveStatus.innerHTML = '<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> Video opgeslagen!</span>';
              }
            } catch (boltError) {
              console.warn('[VideoStudio] BOLT save error:', boltError);
              saveStatus.innerHTML = '<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> Video opgeslagen!</span>';
            }
          } else {
            saveStatus.innerHTML = '<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> Video opgeslagen!</span>';
          }

          // Reload videos
          setTimeout(() => {
            this.loadVideos();
          }, 1000);

        } catch (error) {
          console.error('Save error:', error);
          saveStatus.innerHTML = `<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> ${error.message}</span>`;
        }
      },

      resetGenerator() {
        document.getElementById('progressContainer').classList.remove('active');
        document.getElementById('resultContainer').classList.remove('active');
        document.getElementById('generateBtn').disabled = false;
        document.getElementById('generateBtn').style.opacity = '1';
        document.getElementById('progressBar').style.width = '0%';
        document.getElementById('progressText').textContent = 'Voorbereiden...';

        if (this.statusInterval) {
          clearInterval(this.statusInterval);
          this.statusInterval = null;
        }

        this.renderId = null;
        
        // Reset destinations and clips for new video
        this.destinations = [];
        this.selectedClips = [];
        this.travelData = null;
        document.getElementById('importedDestinations').style.display = 'none';
        document.getElementById('videoTitle').value = 'Mijn Video';
        document.getElementById('travelIdInput').value = '';
        document.getElementById('importStatus').innerHTML = '';
        this.renderDestinations();
      },

      // Destinations management
      destinations: [],
      currentSearchDestination: null,

      renderDestinations() {
        const grid = document.getElementById('destinationsGrid');
        if (!grid) return;

        if (this.destinations.length === 0) {
          grid.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #64748b;">
              <i class="fas fa-map-marker-alt" style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;"></i>
              <p>Geen bestemmingen. Importeer een reis of voeg handmatig toe.</p>
            </div>
          `;
          return;
        }

        grid.innerHTML = this.destinations.map((dest, index) => {
          const clips = this.selectedClips.filter(c => c.destinationIndex === index);
          const clipCount = clips.length;
          const overlayText = dest.overlayText || dest.name;
          const hotelInfo = dest.hotelInfo || '';
          
          return `
            <div class="destination-card" style="background: #0f172a; border: 2px solid ${clipCount > 0 ? '#22c55e' : '#334155'}; border-radius: 12px; padding: 16px; position: relative;">
              <button onclick="VideoStudio.removeDestination(${index})" style="position: absolute; top: 8px; right: 8px; background: transparent; border: none; color: #64748b; cursor: pointer; font-size: 14px;" title="Verwijderen">
                <i class="fas fa-times"></i>
              </button>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h4 style="margin: 0; font-size: 16px; font-weight: 600; color: #e2e8f0;">${dest.name}</h4>
              </div>
              
              <!-- Overlay Text Input -->
              <div style="margin-bottom: 12px;">
                <label style="font-size: 11px; color: #64748b; display: block; margin-bottom: 4px;">Overlay tekst:</label>
                <input type="text" value="${overlayText}" onchange="VideoStudio.updateOverlayText(${index}, this.value)" 
                  style="width: 100%; padding: 8px; background: #1e293b; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; font-size: 13px;"
                  placeholder="Tekst in video">
              </div>
              
              <!-- Hotel Info Input (optional) -->
              <div style="margin-bottom: 12px;">
                <label style="font-size: 11px; color: #64748b; display: block; margin-bottom: 4px;">Hotel info (optioneel):</label>
                <input type="text" value="${hotelInfo}" onchange="VideoStudio.updateHotelInfo(${index}, this.value)" 
                  style="width: 100%; padding: 8px; background: #1e293b; border: 1px solid #334155; border-radius: 6px; color: #e2e8f0; font-size: 13px;"
                  placeholder="Bijv: Hotel Marriott ‚òÖ‚òÖ‚òÖ‚òÖ">
              </div>
              
              <button onclick="VideoStudio.openClipSearch(${index})" class="btn btn-primary" style="width: 100%; padding: 10px; font-size: 13px;">
                <i class="fas fa-search"></i> Zoek clips
              </button>
              <div style="margin-top: 12px;">
                ${clipCount > 0 ? `
                  <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 8px;">
                    ${clips.slice(0, 3).map(clip => `
                      <img src="${clip.thumbnail}" style="width: 50px; height: 35px; object-fit: cover; border-radius: 4px;">
                    `).join('')}
                    ${clipCount > 3 ? `<div style="width: 50px; height: 35px; background: #334155; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #94a3b8;">+${clipCount - 3}</div>` : ''}
                  </div>
                ` : ''}
                <div style="font-size: 12px; color: ${clipCount > 0 ? '#22c55e' : '#64748b'};">
                  <i class="fas fa-film"></i> ${clipCount} clip${clipCount !== 1 ? 's' : ''} geselecteerd
                </div>
              </div>
            </div>
          `;
        }).join('');

        this.updateSelectedCount();
      },

      addDestination() {
        const name = prompt('Voer de naam van de bestemming in:');
        if (!name || !name.trim()) return;

        this.destinations.push({ name: name.trim() });
        this.renderDestinations();
      },

      removeDestination(index) {
        if (!confirm(`Weet je zeker dat je "${this.destinations[index].name}" wilt verwijderen?`)) return;
        
        // Remove clips for this destination
        this.selectedClips = this.selectedClips.filter(c => c.destinationIndex !== index);
        // Update indices for remaining clips
        this.selectedClips = this.selectedClips.map(c => {
          if (c.destinationIndex > index) {
            return { ...c, destinationIndex: c.destinationIndex - 1 };
          }
          return c;
        });
        
        this.destinations.splice(index, 1);
        this.renderDestinations();
      },

      updateOverlayText(index, text) {
        if (this.destinations[index]) {
          this.destinations[index].overlayText = text;
        }
      },

      updateHotelInfo(index, text) {
        if (this.destinations[index]) {
          this.destinations[index].hotelInfo = text;
        }
      },

      // Open clip search with custom query (used by theme buttons)
      async openClipSearchWithQuery(destinationIndex, searchQuery) {
        this.currentSearchDestination = destinationIndex;
        
        // Check if MediaPicker is available
        if (!window.MediaPicker || !window.MediaPicker.openVideo) {
          console.error('[VideoStudio] MediaPicker not available');
          alert('Media Picker niet beschikbaar. Herlaad de pagina.');
          return;
        }

        try {
          // Open MediaPicker in video mode with custom search query
          const result = await window.MediaPicker.openVideo({
            defaultTab: 'pexels',
            searchQuery: searchQuery
          });

          if (!result) {
            console.log('[VideoStudio] User cancelled clip selection');
            return;
          }

          // Handle single video selection
          if (result.source === 'pexels' && result.type === 'video') {
            this.addClipToDestination(destinationIndex, {
              id: result.id || Date.now(),
              url: result.videoUrl || result.url,
              thumbnail: result.thumbnail,
              duration: result.duration || 5
            });
          }
          
          // Handle playlist (multiple videos)
          if (result.type === 'video-playlist' && result.playlist) {
            result.playlist.forEach(video => {
              this.addClipToDestination(destinationIndex, {
                id: video.id || Date.now() + Math.random(),
                url: video.videoUrl || video.url,
                thumbnail: video.thumbnail,
                duration: video.duration || 5
              });
            });
          }

          this.renderDestinations();
        } catch (error) {
          console.error('[VideoStudio] Clip search error:', error);
        }
      },

      async openClipSearch(destinationIndex) {
        this.currentSearchDestination = destinationIndex;
        const dest = this.destinations[destinationIndex];
        
        // Combine destination name with selected theme for better search results
        // e.g. "Malaga" + "drone aerial" = "Malaga drone aerial"
        let searchQuery = dest.name;
        if (this.selectedTheme) {
          searchQuery = `${dest.name} ${this.selectedTheme}`;
        }
        
        // Check if MediaPicker is available
        if (!window.MediaPicker || !window.MediaPicker.openVideo) {
          console.error('[VideoStudio] MediaPicker not available');
          alert('Media Picker niet beschikbaar. Herlaad de pagina.');
          return;
        }

        try {
          // Open MediaPicker in video mode with Pexels tab
          const result = await window.MediaPicker.openVideo({
            defaultTab: 'pexels',
            searchQuery: searchQuery
          });

          if (!result) {
            console.log('[VideoStudio] User cancelled clip selection');
            return;
          }

          // Handle single video selection
          if (result.source === 'pexels' && result.type === 'video') {
            this.addClipToDestination(destinationIndex, {
              id: result.id || Date.now(),
              url: result.videoUrl || result.url,
              thumbnail: result.thumbnail,
              duration: result.duration || 5
            });
          }
          
          // Handle playlist (multiple videos)
          if (result.type === 'video-playlist' && result.playlist) {
            result.playlist.forEach(video => {
              this.addClipToDestination(destinationIndex, {
                id: video.id || Date.now() + Math.random(),
                url: video.videoUrl || video.url,
                thumbnail: video.thumbnail,
                duration: video.duration || 5
              });
            });
          }

        } catch (error) {
          console.error('[VideoStudio] MediaPicker error:', error);
          alert('Fout bij openen Media Picker: ' + error.message);
        }
      },

      addClipToDestination(destinationIndex, clipData) {
        // Check if clip already exists for this destination
        const exists = this.selectedClips.some(
          c => c.id === clipData.id && c.destinationIndex === destinationIndex
        );
        
        if (!exists) {
          this.selectedClips.push({
            id: clipData.id,
            url: clipData.url,
            thumbnail: clipData.thumbnail,
            duration: clipData.duration,
            destinationIndex: destinationIndex,
            destinationName: this.destinations[destinationIndex].name
          });
          
          console.log('[VideoStudio] Clip added for', this.destinations[destinationIndex].name);
        }

        this.updateSelectedCount();
        this.renderDestinations();
      },

      updateSelectedCount() {
        const count = this.selectedClips.length;
        document.getElementById('selectedCount').textContent = `${count} clip${count !== 1 ? 's' : ''} geselecteerd`;
      },

      // Travel Compositor Import
      travelData: null,

      async importTravelId() {
        const input = document.getElementById('travelIdInput');
        const status = document.getElementById('importStatus');
        const ideaId = input.value.trim();

        if (!ideaId) {
          status.innerHTML = '<span style="color: #f59e0b;"><i class="fas fa-exclamation-triangle"></i> Voer een Travel Compositor ID in</span>';
          return;
        }

        status.innerHTML = '<span style="color: #94a3b8;"><i class="fas fa-spinner fa-spin"></i> Laden...</span>';

        try {
          let data = null;
          let source = '';
          
          // Try Supabase trips first (for BOLT trips)
          const tripsResponse = await fetch(`/api/trips/${ideaId}`);
          if (tripsResponse.ok) {
            data = await tripsResponse.json();
            source = 'supabase';
            console.log('[VideoStudio] Trip loaded from Supabase');
          } else {
            // Fallback to Travel Compositor API
            console.log('[VideoStudio] Trip not found in Supabase, trying Travel Compositor...');
            const tcResponse = await fetch(`/api/ideas/${ideaId}`);
            if (tcResponse.ok) {
              data = await tcResponse.json();
              source = 'travelcompositor';
              console.log('[VideoStudio] Trip loaded from Travel Compositor');
            } else {
              throw new Error('Reis niet gevonden in Supabase of Travel Compositor');
            }
          }
          
          this.travelData = data;

          // Update title
          const title = data.title || data.name || 'Mijn Reis';
          document.getElementById('videoTitle').value = title;

          // Load destinations into the destinations array
          const destinations = data.destinations || [];
          if (destinations.length > 0) {
            // Clear existing destinations and clips
            this.destinations = [];
            this.selectedClips = [];
            
            // Add each destination
            destinations.forEach(dest => {
              const name = dest.name || dest.title || dest;
              this.destinations.push({ name: name });
            });

            // Show imported destinations tags
            document.getElementById('importedDestinations').style.display = 'block';
            document.getElementById('destinationTags').innerHTML = this.destinations.map(dest => {
              return `<span style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500;">${dest.name}</span>`;
            }).join('');

            status.innerHTML = `<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> "${title}" geladen met ${destinations.length} bestemming${destinations.length !== 1 ? 'en' : ''}</span>`;

            // Show overlay settings if we have hotel/flight data
            const hasHotels = data.hotels && data.hotels.length > 0;
            const hasFlights = data.flights && data.flights.length > 0;
            if (hasHotels || hasFlights) {
              document.getElementById('overlaySettings').style.display = 'block';
            }

            // Render the destinations grid
            this.renderDestinations();
          } else {
            status.innerHTML = `<span style="color: #22c55e;"><i class="fas fa-check-circle"></i> "${title}" geladen (geen bestemmingen gevonden)</span>`;
          }

        } catch (error) {
          console.error('Import error:', error);
          status.innerHTML = `<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> ${error.message}</span>`;
        }
      },

      // Search clips for each destination from imported travel
      async searchDestinationClips() {
        if (!this.travelData || !this.travelData.destinations) return;

        for (const dest of this.travelData.destinations) {
          const name = dest.name || dest.title || dest;
          await this.searchClips(name);
        }
      },

      // Deeplink handler for BOLT integration
      handleDeeplink() {
        const params = new URLSearchParams(window.location.search);
        
        // Get deeplink parameters
        const tripId = params.get('trip_id') || params.get('id');
        const brandId = params.get('brand_id');
        const token = params.get('token');
        const apiKey = params.get('apikey');
        const returnUrl = params.get('return_url');
        const title = params.get('title');
        
        // Store return URL for later
        if (returnUrl) {
          this.returnUrl = decodeURIComponent(returnUrl);
          this.showReturnButton();
        }
        
        // Store auth info
        if (token) this.authToken = token;
        if (apiKey) this.apiKey = apiKey;
        if (brandId) this.brandId = brandId;
        
        // If we have a trip ID, auto-load it
        if (tripId) {
          console.log('[VideoStudio] Deeplink detected, loading trip:', tripId);
          
          // Set the input field
          document.getElementById('travelIdInput').value = tripId;
          
          // If title is provided, set it
          if (title) {
            document.getElementById('videoTitle').value = decodeURIComponent(title);
          }
          
          // Auto-import after a short delay (to ensure DOM is ready)
          setTimeout(() => {
            this.importTravelId();
          }, 500);
        }
      },

      showReturnButton() {
        // Add return button to sidebar footer
        const footer = document.querySelector('.sidebar-footer');
        console.log('[VideoStudio] showReturnButton called, returnUrl:', this.returnUrl, 'footer:', footer);
        if (footer && this.returnUrl) {
          footer.innerHTML = `
            <button onclick="VideoStudio.returnToBolt()" class="btn btn-secondary" style="width: 100%; margin-bottom: 8px;">
              <i class="fas fa-arrow-left"></i> Terug naar AI Studio
            </button>
            <div style="font-size: 12px; color: #64748b;">¬© 2026 AI Travel Video</div>
          `;
          console.log('[VideoStudio] Return button added to footer');
        } else {
          console.warn('[VideoStudio] Could not add return button - footer:', !!footer, 'returnUrl:', !!this.returnUrl);
        }
      },

      returnToBolt() {
        if (this.returnUrl) {
          window.location.href = this.returnUrl;
        }
      },

      // Toggle collapsible sections
      toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const icon = document.getElementById(sectionId + 'Icon');
        if (section) {
          const isHidden = section.style.display === 'none';
          section.style.display = isHidden ? 'block' : 'none';
          if (icon) {
            icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
          }
        }
      }
    };

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      VideoStudio.init();
    });

    // Also try to load config
    if (typeof window.MEDIA_CONFIG === 'undefined') {
      // Try to load from config file
      const script = document.createElement('script');
      script.src = '/js/config.local.js';
      script.onerror = () => console.log('No local config found');
      document.head.appendChild(script);
    }
  </script>
</body>
</html>
